version: "3.3"
services:
  ydb:
    image: ydbplatform/local-ydb:latest
    restart: always
    ports:
      - "2135:2135"
      - "8765:8765" # WEB UI
      - "9092:9092"
      - "2136:2136"
    hostname: localhost
    environment:
      - YDB_USE_IN_MEMORY_PDISKS=true
      - YDB_ENABLE_COLUMN_TABLES=true

  api:

    build:
      context: services/api
      dockerfile: Dockerfile

    environment:
      - DOCUMENT_API_ENDPOINT=key
      - DOCUMENT_DATABASE_PATH=key
      - AWS_ACCESS_KEY_ID=key
      - AWS_SECRET_ACCESS_KEY=key
      - JWT_PRIVATE_KEY=key
      - PYTHONDONTWRITEBYTECODE=1
      - PYTHONUNBUFFERED=1

    ports:
      - "8080:8080"
      # Debug port
      - "5678:5678"
      
    depends_on:
      - ydb


    command: ["sh", "-c", "pip install debugpy -t /tmp && python /tmp/debugpy --wait-for-client --listen 0.0.0.0:5678 -m uvicorn main:app --host 0.0.0.0 --port 8080 --reload"]



    volumes:
      - ./services/api:/app
 

  
